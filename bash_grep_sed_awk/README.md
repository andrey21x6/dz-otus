# Инициализация системы. Systemd.

# **Prerequisite**

- Host OS: Ubuntu Desktop 20.04.4

# **Содержание ДЗ**

Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.
Необходимая информация в письме:

* Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
* Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
* Ошибки веб-сервера/приложения c момента последнего запуска;
* Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
* Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.
* В письме должен быть прописан обрабатываемый временной диапазон.

# **Выполнение**

### Описание работы скрипта


Ищет строку, где есть запись Start___Script___Send___Mail и забирает всё, что идёт после нее
```
awk 'go { print } $0 == "Start___Script___Send___Mail" { go = 1 }'
```

Регулярное выражение для IP адреса
```
grep -o -E "(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"
```

Числовая сортировка
```
sort -n
```

Ищет одинаковые строки и в начале каждой строки выводит число, которое обозначает количество повторов
```
uniq -c
```

Убирает пустоты первого столбца
```
awk '{gsub(/^[ \t]+| [ \t]+$/,""); print $0 }'
```
























# **Результаты**

- Полученный в ходе работы `Vagrantfile` помещен в публичный репозиторий:
**GitHub** - https://github.com/andrey21x6/dz-otus/tree/main/systemd
- Написал service, который раз в 30 секунд мониторить лог на предмет наличия ключевого слова
- Из репозитория epel установил spawn-fcgi и переписал init-скрипт на unit-файл
- Дополнил unit-файл httpd возможностью запустить несколько инстансов сервера с разными конфигурационными файлами

